# Copyright 2023 Nokia
# Licensed under the BSD 3-Clause License.
# SPDX-License-Identifier: BSD-3-Clause
#Author: amerf@outlook.com (github: skyglid3r)
name: sfmix-static
prefix: ""
topology:
  nodes:
    pe1:
      kind: vr-sros
      image: vr-sros:24.10.R3
      type: sr-1
      license: ./sfmix-sros-24.txt
      startup-config: ./configs/pe1_config.txt
      ports:
        - 51001:22
        - 51301:57400
        - 51401:830
    pe2:
      kind: vr-sros
      image: vr-sros:24.10.R3
      type: sr-1
      license: ./sfmix-sros-24.txt
      startup-config: ./configs/pe2_config.txt
      ports:
        - 52001:22
        - 52301:57400
        - 52401:830    
    gw-pe:
      kind: vr-sros
      image: vr-sros:24.10.R3
      type: sr-1
      license: ./sfmix-sros-24.txt
      startup-config: ./configs/gw_pe_config.txt
      ports:
        - 53001:22
        - 53301:57400
        - 53401:830

    client1:
      kind: linux
      image: ghcr.io/mfzhsn/network-multitool-sshd:0.0.2
      exec:
        - ip link add bond0 type bond mode 802.3ad lacp_rate fast
        - ip link set address 00:00:00:00:00:11 dev bond0
        - ip link set eth1 down
        - ip link set eth1 master bond0
        - ip link set eth1 up
        - ip link set bond0 up
        - ip link add link bond0 name bond0.10 type vlan id 10
        - ip link add link bond0 name bond0.20 type vlan id 20
        - ip link add link bond0 name bond0.30 type vlan id 30
        - ip link set bond0.10 up
        - ip link set bond0.20 up
        - ip link set bond0.30 up
        - ip addr add 192.168.10.1/24 dev bond0.10
        - ip addr add 192.168.20.1/24 dev bond0.20
        - ip addr add 192.168.30.1/24 dev bond0.30
    
    client2:
      kind: linux
      image: ghcr.io/mfzhsn/network-multitool-sshd:0.0.2
      exec:
        - ip link add bond0 type bond mode 802.3ad lacp_rate fast
        - ip link set address 00:00:00:00:00:21 dev bond0
        - ip link set eth1 down
        - ip link set eth1 master bond0
        - ip link set eth1 up
        - ip link set bond0 up
        - ip link add link bond0 name bond0.10 type vlan id 10
        - ip link add link bond0 name bond0.20 type vlan id 20
        - ip link add link bond0 name bond0.30 type vlan id 30
        - ip link set bond0.10 up
        - ip link set bond0.20 up
        - ip link set bond0.30 up
        - ip addr add 192.168.10.2/24 dev bond0.10
        - ip addr add 192.168.20.2/24 dev bond0.20
        - ip addr add 192.168.30.2/24 dev bond0.30

    client3:
      kind: linux
      image: ghcr.io/mfzhsn/network-multitool-sshd:0.0.2
      exec:
        - ip link add bond0 type bond mode 802.3ad lacp_rate fast
        - ip link set address 00:00:00:00:00:31 dev bond0
        - ip link set eth1 down
        - ip link set eth1 master bond0
        - ip link set eth1 up
        - ip link set bond0 up
        - ip link add link bond0 name bond0.30 type vlan id 30
        - ip link set bond0.30 up
        - ip addr add 192.168.30.3/24 dev bond0.30

  links:
    - endpoints: ["client1:eth1", "pe1:eth4"]
    - endpoints: ["client2:eth1", "pe2:eth4"]
    - endpoints: ["gw-pe:eth1", "pe1:eth5"]
    - endpoints: ["gw-pe:eth2", "pe2:eth5"]
    - endpoints: ["gw-pe:eth3", "client3:eth1"]


